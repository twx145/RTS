<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>神盾计划 - 实时战略游戏</title>
    <link rel="icon" href="data:,">
    <link rel="stylesheet" href="../css/game_style.css">
    <link rel="stylesheet" href="../css/achievements.css">
    <link rel="stylesheet" href="../css/alert.css">
</head>
<body>
    <!-- 新增: 侧边栏切换按钮 -->
    <button id="sidebar-toggle-btn" class="sidebar-toggle-btn">
        <span>›</span>
    </button>

    <div id="game-wrapper">
        <div id="game-container">
            <canvas id="game-canvas" width="1600" height="900"></canvas>
            <aside id="sidebar">
                <!-- ... 侧边栏内部内容保持不变 ... -->
                <h2>控制面板</h2>
                <div id="player-info">
                    <div id="player-base-hp-display" style="display:none;">
                        <strong>我方基地HP:</strong>
                        <div class="hp-bar-container"><div id="player-base-hp-bar" class="hp-bar"></div></div>
                    </div>
                    <div id="ai-base-hp-display" style="display:none;">
                        <strong>敌方基地HP:</strong>
                        <div class="hp-bar-container"><div id="ai-base-hp-bar" class="hp-bar"></div></div>
                    </div>
                    <h3>我方兵力: <span id="player-manpower">100</span></h3>
                </div>
                <div id="game-controls">
                    <button id="start-battle-btn">开始战斗</button>
                    <p id="game-status">状态: 部署阶段</p>
                </div>
                 <div id="selected-unit-info">
                    <h4>选中单位信息</h4><p>无</p>
                </div>
                <div id="unit-selection"></div>
            </aside>
        </div>
    </div>

    <div id="setup-screen" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h1>游戏设置</h1>
            <div class="form-group">
                <label for="game-mode-select">游戏模式:</label>
                <select id="game-mode-select">
                    <option value="annihilation" selected>对攻模式</option>
                    <option value="attack">进攻模式</option>
                    <option value="defend">防守模式</option>
                </select>
            </div>
            <div class="form-group">
                <label for="map-select">选择地图:</label>
                <select id="map-select"></select>
            </div>
            <div class="form-group">
                <label for="game-speed-select">游戏速度:</label>
                <select id="game-speed-select">
                    <option value="0.5">慢速 (0.5x)</option>
                    <option value="1" selected>正常 (1x)</option>
                    <option value="1.5">快速 (1.5x)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="ai-difficulty-select">AI难度:</label>
                <select id="ai-difficulty-select">
                    <option value="simple">简单</option>
                    <option value="medium" selected>中等</option>
                    <option value="hard">困难</option>
                    <option value="hell">地狱</option>
                </select>
            </div>
            <div class="form-group checkbox-group">
                <input type="checkbox" id="show-details-checkbox">
                <label for="show-details-checkbox">游戏中显示详细信息 (射程/路径)</label>
            </div>
            <button id="start-new-game-btn">创建游戏</button>
        </div>
    </div>

    <!-- 修改 增加新手教程 -->
    <div id="tutorial-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content tutorial-content">
            <h1>神盾计划 - 新手教程</h1>
            <div id="tutorial-steps">
                <div class="tutorial-step" data-step="1">
                    <h2>欢迎来到神盾计划</h2>
                    <p>这是一款实时战略游戏，您需要部署单位、指挥战斗并击败对手。</p>
                    <div class="tutorial-image-container">
                        <div class="tutorial-image-placeholder large">游戏主界面示意图</div>
                    </div>
                    <div class="tutorial-tip">
                        <strong>提示:</strong> 教程结束后，您可以在游戏设置中重新查看教程。
                    </div>
                </div>
                <div class="tutorial-step" data-step="2" style="display: none;">
                    <h2>部署阶段</h2>
                    <p>在游戏开始时，您处于部署阶段：</p>
                    <ul>
                        <li>从右侧面板选择单位类型</li>
                        <li>点击地图左侧1/3区域部署单位</li>
                        <li><strong>R键</strong> - 在部署阶段撤销最后部署的单位</li>
                        <li>不同单位有不同的成本和能力</li>
                        <li>合理分配资源，组建均衡的部队</li>
                    </ul>
                    <div class="tutorial-image-container">
                        <div class="tutorial-image-placeholder large">单位选择与部署示意图</div>
                    </div>
                </div>
                <div class="tutorial-step" data-step="3" style="display: none;">
                    <h2>视角控制</h2>
                    <p>您可以控制游戏视角来观察战场：</p>
                    <ul>
                        <li><strong>鼠标中键或Ctrl+左键</strong> - 拖拽移动视角</li>
                        <li><strong>Ctrl+鼠标滚轮</strong> - 缩放视角</li>
                        <li><strong>鼠标滚轮</strong> - 滚动视角</li>
                        <li>将鼠标移动到屏幕边缘也可自动滚动视角</li>
                    </ul>
                    <div class="tutorial-image-container">
                        <div class="tutorial-image-placeholder large">视角控制示意图</div>
                    </div>
                </div>
                <div class="tutorial-step" data-step="4" style="display: none;">
                    <h2>单位选择与指挥</h2>
                    <p>战斗开始后，您需要指挥您的部队：</p>
                    <ul>
                        <li><strong>左键点击</strong> - 选择单个单位</li>
                        <li><strong>拖拽框选</strong> - 选择多个单位</li>
                        <li><strong>左键点击地面</strong> - 移动选中单位</li>
                        <li><strong>右键点击敌方单位</strong> - 攻击目标</li>
                        <li><strong>ESC键</strong> - 取消当前选择</li>
                    </ul>
                    <div class="tutorial-image-container">
                        <div class="tutorial-image-placeholder large">单位指挥示意图</div>
                    </div>
                    <div class="tutorial-tip">
                        <strong>提示:</strong> 合理搭配不同单位类型，利用各自的优势和劣势。
                    </div>
                </div>
                <div class="tutorial-step" data-step="5" style="display: none;">
                    <h2>高级控制与编队系统</h2>
                    <p>使用编队系统可以更高效地管理您的部队：</p>
                    <ul>
                        <li><strong>Q键</strong> - 让选中单位停止当前行动</li>
                        <li><strong>T键</strong> - 选中与当前选择同类型的所有单位</li>
                        <li><strong>Ctrl + 数字键(0-9)</strong> - 将选中单位分配到对应编队</li>
                        <li><strong>数字键(0-9)</strong> - 快速选择对应编队的所有单位</li>
                        <li><strong>Ctrl + 数字键(无选中单位)</strong> - 解散对应编队</li>
                    </ul>
                    <div class="tutorial-image-container">
                        <div class="tutorial-image-placeholder large">编队系统示意图</div>
                    </div>
                    <div class="tutorial-tip">
                        <strong>高级技巧:</strong> 使用编队可以快速切换不同兵种组合，应对多变战局。
                        例如，将坦克编为1队，步兵编为2队，可以快速切换指挥。
                    </div>
                </div>
                <div class="tutorial-step" data-step="6" style="display: none;">
                    <h2>游戏模式与胜利条件</h2>
                    <p>根据游戏模式不同，胜利条件也不同：</p>
                    <ul>
                        <li><strong>对攻模式</strong>: 摧毁敌方基地，同时保护自己的基地</li>
                        <li><strong>进攻模式</strong>: 摧毁敌方基地</li>
                        <li><strong>防守模式</strong>: 保护我方基地不被摧毁</li>
                        <li><strong>特殊模式</strong>: 胜利条件随剧情而改变</li>
                    </ul>
                    <div class="tutorial-image-container">
                        <div class="tutorial-image-placeholder large">胜利条件示意图</div>
                    </div>
                    <div class="tutorial-tip">
                        <strong>提示:</strong> 合理利用地形优势，制定合适的战略是取胜的关键。
                    </div>
                </div>
            </div>
            <div class="tutorial-progress">
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 20%;"></div>
                </div>
                <div class="progress-text">步骤 1/6</div>
            </div>
            <div class="tutorial-controls">
                <button id="tutorial-prev" class="tutorial-btn" disabled>上一步</button>
                <button id="tutorial-next" class="tutorial-btn">下一步</button>
                <button id="tutorial-skip" class="tutorial-btn skip-btn">跳过教程</button>
            </div>
        </div>
    </div>

    <!-- 修改 增加设置按钮 -->
    <div id="settings-button" class="settings-button">    ⚙️</div>

    <!-- 设置菜单 -->
    <div id="settings-menu" class="settings-menu">
        <h3>游戏设置</h3>
        
        <div class="settings-section">
            <h4>音量控制</h4>
            <div class="volume-control">
                <label>背景音乐:</label>
                <input type="range" min="0" max="100" value="50" class="volume-slider" id="bgm-volume">
                <span id="bgm-volume-value">50%</span>
            </div>
            <div class="volume-control">
                <label>游戏音效:</label>
                <input type="range" min="0" max="100" value="70" class="volume-slider" id="sfx-volume">
                <span id="sfx-volume-value">70%</span>
            </div>
        </div>
        
        <div class="settings-section">
            <h4>游戏选项</h4>
            <button id="show-tutorial" class="menu-button">查看教程</button>
            <button id="save-game" class="menu-button">保存游戏</button>
            <button id="load-game" class="menu-button">读取存档</button>
            <button id="skip-scenario" class="menu-button">跳过当前关卡</button>
        </div>
        
        <div class="settings-section">
            <h4>系统</h4>
            <button id="return-main" class="menu-button warning">返回主菜单</button>
            <button id="exit-game" class="menu-button danger">退出游戏</button>
        </div>
        
        <div class="settings-footer">
            <button id="close-settings" class="menu-button">关闭</button>
        </div>
    </div>

    <!-- 确认对话框 -->
    <div id="confirm-dialog" class="Mmodal">
        <div class="Mmodal-content">
            <h3 id="confirm-title">确认操作</h3>
            <p id="confirm-message">您确定要执行此操作吗？</p>
            <div class="Mmodal-buttons">
                <button id="confirm-yes" class="danger-btn">确定</button>
                <button id="confirm-no" class="secondary-btn">取消</button>
            </div>
        </div>
    </div>
    <!-- 提示对话框 -->
    <div id="alert-dialog" class="Mmodal">
        <div class="Mmodal-content">
            <h3 id="alert-title">提示</h3>
            <p id="alert-message"></p>
            <div class="Mmodal-buttons">
                <button id="alert-ok" class="primary-btn">确定</button>
            </div>
        </div>
    </div>
    
    <script src="../js/alert.js"></script>
    <script src="../lib/pathfinding-browser.min.js"></script>
    <script src="../lib/matter.min.js"></script>
    <script src="../data/script.js"></script>
    <script src="../game_js/utils.js"></script>
    <script src="../game_js/config.js"></script>
    <script src="../game_js/maps-data.js"></script>
    <script src="../game_js/buildings-manager.js"></script>
    <script src="../game_js/pathfinding.js"></script>
    <script src="../game_js/projectile.js"></script>
    <script src="../game_js/base.js"></script>
    <script src="../game_js/unit.js"></script>
    <script src="../game_js/map.js"></script>
    <script src="../game_js/fog-of-war.js"></script>
    <script src="../js/saveGame.js"></script>
    <script src="../game_js/ui.js"></script>
    <script src="../game_js/ai.js"></script>
    <script src="../game_js/player.js"></script>
    <script src="../game_js/game.js"></script>
    <script src="../game_js/main.js"></script>
</body>
</html>